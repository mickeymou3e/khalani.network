"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8171],{68171:function(e,t,n){n.r(t),n.d(t,{default:function(){return B}});var i=n(17187),o=n.n(i),c=n(50580),r=n(48764).Buffer,s=function(e,t,n,i){return new(n||(n=Promise))((function(o,c){function r(e){try{a(i.next(e))}catch(t){c(t)}}function s(e){try{a(i.throw(e))}catch(t){c(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}a((i=i.apply(e,t||[])).next())}))};class a{constructor(){this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new(o()),this.send=(e,t,n,i,o=r.alloc(0),a=[c.WC.OK])=>s(this,void 0,void 0,(function*(){if(o.length>=256)throw new c.PS("data.length exceed 256 bytes limit. Got: "+o.length,"DataLengthTooBig");const s=yield this.exchange(r.concat([r.from([e,t,n,i]),r.from([o.length]),o])),d=s.readUInt16BE(s.length-2);if(!a.some((e=>e===d)))throw new c.rZ(d);return s})),this.exchangeAtomicImpl=e=>s(this,void 0,void 0,(function*(){if(this.exchangeBusyPromise)throw new c.wp("An action was already pending on the Ledger device. Please deny or reconnect.");let t;const n=new Promise((e=>{t=e}));this.exchangeBusyPromise=n;let i=!1;const o=setTimeout((()=>{i=!0,this.emit("unresponsive")}),this.unresponsiveTimeout);try{const n=yield e();return i&&this.emit("responsive"),n}finally{clearTimeout(o),t&&t(),this.exchangeBusyPromise=null}})),this._appAPIlock=null}exchange(e){throw new Error("exchange not implemented")}exchangeBulk(e,t){let n=!1;return(()=>s(this,void 0,void 0,(function*(){if(!n)for(const i of e){const e=yield this.exchange(i);if(n)return;const o=e.readUInt16BE(e.length-2);if(o!==c.WC.OK)throw new c.rZ(o);t.next(e)}})))().then((()=>!n&&t.complete()),(e=>!n&&t.error(e))),{unsubscribe:()=>{n=!0}}}setScrambleKey(e){}close(){return Promise.resolve()}on(e,t){this._events.on(e,t)}off(e,t){this._events.removeListener(e,t)}emit(e,...t){this._events.emit(e,...t)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(e){this.exchangeTimeout=e}setExchangeUnresponsiveTimeout(e){this.unresponsiveTimeout=e}static create(e=3e3,t){return new Promise(((n,i)=>{let o=!1;const r=this.listen({next:t=>{o=!0,r&&r.unsubscribe(),s&&clearTimeout(s),this.open(t.descriptor,e).then(n,i)},error:e=>{s&&clearTimeout(s),i(e)},complete:()=>{s&&clearTimeout(s),o||i(new c.PS(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),s=t?setTimeout((()=>{r.unsubscribe(),i(new c.PS(this.ErrorMessage_ListenTimeout,"ListenTimeout"))}),t):null}))}decorateAppAPIMethods(e,t,n){for(const i of t)e[i]=this.decorateAppAPIMethod(i,e[i],e,n)}decorateAppAPIMethod(e,t,n,i){return(...o)=>s(this,void 0,void 0,(function*(){const{_appAPIlock:r}=this;if(r)return Promise.reject(new c.PS("Ledger Device is busy (lock "+r+")","TransportLocked"));try{return this._appAPIlock=e,this.setScrambleKey(i),yield t.apply(n,o)}finally{this._appAPIlock=null}}))}}a.ErrorMessage_ListenTimeout="No Ledger device found (timeout)",a.ErrorMessage_NoDeviceFound="No Ledger device found";var d=n(48764).Buffer;function u(e){const t=d.alloc(2);return t.writeUInt16BE(e,0),t}const l={data:d.alloc(0),dataLength:0,sequence:0};var h=(e,t)=>({makeBlocks(n){let i=d.concat([u(n.length),n]);const o=t-5,c=Math.ceil(i.length/o);i=d.concat([i,d.alloc(c*o-i.length+1).fill(0)]);const r=[];for(let t=0;t<c;t++){const n=d.alloc(5);n.writeUInt16BE(e,0),n.writeUInt8(5,2),n.writeUInt16BE(t,3);const c=i.slice(t*o,(t+1)*o);r.push(d.concat([n,c]))}return r},reduceResponse(t,n){let{data:i,dataLength:o,sequence:r}=t||l;if(n.readUInt16BE(0)!==e)throw new c.PS("Invalid channel","InvalidChannel");if(5!==n.readUInt8(2))throw new c.PS("Invalid tag","InvalidTag");if(n.readUInt16BE(3)!==r)throw new c.PS("Invalid sequence","InvalidSequence");t||(o=n.readUInt16BE(5)),r++;const s=n.slice(t?5:7);return i=d.concat([i,s]),i.length>o&&(i=i.slice(0,o)),{data:i,dataLength:o,sequence:r}},getReducedResult(e){if(e&&e.dataLength===e.data.length)return e.data}}),f=n(81249),v=n.n(f);var m;!function(e){e.blue="blue",e.nanoS="nanoS",e.nanoSP="nanoSP",e.nanoX="nanoX",e.stax="stax"}(m||(m={}));const g={[m.blue]:{id:m.blue,productName:"Ledger\xa0Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:491520,masks:[822083584,822149120],getBlockSize:e=>4096},[m.nanoS]:{id:m.nanoS,productName:"Ledger\xa0Nano\xa0S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:327680,masks:[823132160],getBlockSize:e=>{var t;return v().lt(null!==(t=v().coerce(e))&&void 0!==t?t:"","2.0.0")?4096:2048}},[m.nanoSP]:{id:m.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1572864,masks:[856686592],getBlockSize:e=>32},[m.nanoX]:{id:m.nanoX,productName:"Ledger\xa0Nano\xa0X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2097152,masks:[855638016],getBlockSize:e=>4096,bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},[m.stax]:{id:m.stax,productName:"Ledger\xa0Stax",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:1572864,masks:[857735168],getBlockSize:e=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]}},p=(m.blue,m.nanoS,m.nanoSP,m.nanoX,m.stax,Object.values(g)),y=e=>{const t=p.find((t=>t.legacyUsbProductId===e));if(t)return t;const n=e>>8;return p.find((e=>e.productIdMM===n))},w=[],b={};for(const L in g){const e=g[L],{bluetoothSpec:t}=e;if(t)for(let n=0;n<t.length;n++){const i=t[n];w.push(i.serviceUuid),b[i.serviceUuid]=b[i.serviceUuid.replace(/-/g,"")]=Object.assign({deviceModel:e},i)}}var I=n(28716),S=function(e,t,n,i){return new(n||(n=Promise))((function(o,c){function r(e){try{a(i.next(e))}catch(t){c(t)}}function s(e){try{a(i.throw(e))}catch(t){c(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}a((i=i.apply(e,t||[])).next())}))};const P=[{vendorId:11415}];function x(){return S(this,void 0,void 0,(function*(){return yield navigator.usb.requestDevice({filters:P})}))}function M(){return S(this,void 0,void 0,(function*(){return(yield navigator.usb.getDevices()).filter((e=>11415===e.vendorId))}))}var U=n(48764).Buffer,k=function(e,t,n,i){return new(n||(n=Promise))((function(o,c){function r(e){try{a(i.next(e))}catch(t){c(t)}}function s(e){try{a(i.throw(e))}catch(t){c(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}a((i=i.apply(e,t||[])).next())}))};class B extends a{constructor(e,t){super(),this.channel=Math.floor(65535*Math.random()),this.packetSize=64,this._disconnectEmitted=!1,this._emitDisconnect=e=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",e))},this.device=e,this.interfaceNumber=t,this.deviceModel=y(e.productId)}static request(){return k(this,void 0,void 0,(function*(){const e=yield x();return B.open(e)}))}static openConnected(){return k(this,void 0,void 0,(function*(){const e=yield M();return 0===e.length?null:B.open(e[0])}))}static open(e){return k(this,void 0,void 0,(function*(){yield e.open(),null===e.configuration&&(yield e.selectConfiguration(1)),yield E(e);const t=e.configurations[0].interfaces.find((({alternates:e})=>e.some((e=>255===e.interfaceClass))));if(!t)throw new c.$u("No WebUSB interface found for your Ledger device. Please upgrade firmware or contact techsupport.");const n=t.interfaceNumber;try{yield e.claimInterface(n)}catch(r){throw yield e.close(),new c.$u(r.message)}const i=new B(e,n),o=t=>{e===t.device&&(navigator.usb.removeEventListener("disconnect",o),i._emitDisconnect(new c.qX))};return navigator.usb.addEventListener("disconnect",o),i}))}close(){return k(this,void 0,void 0,(function*(){yield this.exchangeBusyPromise,yield this.device.releaseInterface(this.interfaceNumber),yield E(this.device),yield this.device.close()}))}exchange(e){return k(this,void 0,void 0,(function*(){return yield this.exchangeAtomicImpl((()=>k(this,void 0,void 0,(function*(){const{channel:t,packetSize:n}=this;(0,I.c)("apdu","=> "+e.toString("hex"));const i=h(t,n),o=i.makeBlocks(e);for(let e=0;e<o.length;e++)yield this.device.transferOut(3,o[e]);let c,r;for(;!(c=i.getReducedResult(r));){const e=yield this.device.transferIn(3,n),t=U.from(e.data.buffer);r=i.reduceResponse(r,t)}return(0,I.c)("apdu","<= "+c.toString("hex")),c})))).catch((e=>{if(e&&e.message&&e.message.includes("disconnected"))throw this._emitDisconnect(e),new c.vs(e.message);throw e}))}))}setScrambleKey(){}}function E(e){return k(this,void 0,void 0,(function*(){try{yield e.reset()}catch(t){console.warn(t)}}))}B.isSupported=()=>Promise.resolve(!!navigator&&!!navigator.usb&&"function"===typeof navigator.usb.getDevices),B.list=M,B.listen=e=>{let t=!1;return function(){return S(this,void 0,void 0,(function*(){const e=yield M();return e.length>0?e[0]:x()}))}().then((n=>{if(!t){const t=y(n.productId);e.next({type:"add",descriptor:n,deviceModel:t}),e.complete()}}),(t=>{window.DOMException&&t instanceof window.DOMException&&18===t.code?e.error(new c.um(t.message)):e.error(new c.FB(t.message))})),{unsubscribe:function(){t=!0}}}}}]);
//# sourceMappingURL=8171.4cd8e74cf9d10b88.js.map